<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      name="description"
      content="CitySort AI MVP case study: ingest, OCR, classify, validate, and route city documents with human-in-the-loop review."
    />

    <title>CitySort AI MVP - Case Study</title>

    <link rel="icon" href="../../assets/favicon.svg" type="image/svg+xml" />
    <link rel="stylesheet" href="../../styles.css" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <script src="../../script.js" defer></script>
  </head>
  <body>
    <a class="skip-link" href="#content">Skip to content</a>

    <header class="site-header">
      <div class="container header-inner">
        <a class="brand" href="../../" aria-label="Home">
          <span class="brand-mark" aria-hidden="true">I</span>
          <span class="brand-text">Imran Tanbir</span>
        </a>

        <nav class="site-nav" aria-label="Primary">
          <a href="../../#about">About</a>
          <a href="../../#skills">Skills</a>
          <a href="../../#projects">Projects</a>
          <a href="../../#experience">Experience</a>
          <a href="../../#contact" class="nav-cta">Contact</a>
        </nav>
      </div>
    </header>

    <main id="content" class="page">
      <section class="section">
        <div class="container">
          <p class="crumb" data-reveal>
            <a href="../../#projects">Projects</a>
            <span class="sep" aria-hidden="true">/</span>
            <span>CitySort</span>
          </p>

          <div class="project-hero" data-reveal>
            <div class="project-hero-top">
              <img
                class="project-icon"
                src="../../assets/citysort.svg"
                width="64"
                height="64"
                alt=""
                aria-hidden="true"
              />
              <div>
                <h1 class="project-title">CitySort</h1>
                <p class="project-subtitle">
                  A runnable AI MVP to ingest, OCR, classify, validate, and route
                  city documents with human-in-the-loop review.
                </p>
              </div>
            </div>

            <div class="project-actions">
              <a class="btn btn-primary" href="../../#contact">Work with me</a>
              <a
                class="btn btn-ghost"
                href="https://github.com/imranow/Citysort"
                target="_blank"
                rel="noreferrer"
                >Repo</a
              >
              <a class="btn btn-ghost" href="#" aria-disabled="true">Live</a>
            </div>
          </div>

          <div class="prose" data-reveal>
            <h2>Problem</h2>
            <p>
              City teams handle high volumes of documents that need to be
              extracted, classified, validated, and routed quickly. Manual triage
              is slow and inconsistent, and you still need auditability and safe
              fallbacks when OCR/LLM providers are unavailable.
            </p>

            <h2>What it is</h2>
            <p>
              CitySort AI MVP is a runnable pipeline that can ingest city
              documents, extract fields, classify document type, validate required
              fields, and route items into department queues with a
              human-in-the-loop review workflow.
            </p>

            <h2>Document lifecycle</h2>
            <p>
              Documents move through explicit states so operators always know
              what happened and what to do next:
              <code>ingested</code>, <code>routed</code>,
              <code>needs_review</code>, <code>approved</code>,
              <code>corrected</code>, <code>failed</code>.
            </p>

            <h2>AI providers (Anthropic + fallback)</h2>
            <p>
              OCR and classification are provider-switched. If credentials are
              missing or calls fail, the system automatically falls back to local
              processing so the pipeline keeps moving.
            </p>
            <ul>
              <li>
                OCR providers: <code>local</code> (native text + PDF parsing),
                <code>azure_di</code> (Azure Document Intelligence)
              </li>
              <li>
                Classification providers: <code>rules</code> (keyword model),
                <code>openai</code> (JSON classification),
                <code>anthropic</code> (JSON classification)
              </li>
              <li>
                Confidence gate for auto-routing via
                <code>CITYSORT_CONFIDENCE_THRESHOLD</code> (default 0.82)
              </li>
              <li>
                Always-human-review doc types via
                <code>CITYSORT_FORCE_REVIEW_DOC_TYPES</code>
              </li>
            </ul>

            <h2>Human-in-the-loop review</h2>
            <p>
              The dashboard supports operator review actions end-to-end, with a
              review pane that shows extracted fields, validation issues,
              corrected JSON fields, text preview, and per-document audit
              history.
            </p>
            <ul>
              <li>
                Reprocess selected documents to apply the latest rules/providers
                without re-upload
              </li>
              <li>
                Audit trail API per document:
                <code>/api/documents/{id}/audit</code>
              </li>
            </ul>

            <h2>Rules and routing without code changes</h2>
            <p>
              Rules are configurable at runtime. The UI includes a rules editor
              plus a form-based rules builder (types, keywords, required fields,
              routing) so most users never need to touch JSON.
            </p>
            <ul>
              <li>
                Rules config APIs: <code>GET/PUT /api/config/rules</code>,
                <code>POST /api/config/rules/reset</code>
              </li>
              <li>Department queues + analytics APIs for routing visibility</li>
            </ul>

            <h2>Platform operations (enterprise-style controls)</h2>
            <p>
              CitySort includes platform APIs for connectivity checks, manual
              deployments, invitations, and API key lifecycle management.
            </p>
            <ul>
              <li>
                Connectivity: <code>GET /api/platform/connectivity</code>,
                <code>POST /api/platform/connectivity/check</code>
              </li>
              <li>
                Deployments: <code>POST /api/platform/deployments/manual</code>,
                <code>GET /api/platform/deployments</code>
              </li>
              <li>
                Invitations: <code>POST /api/platform/invitations</code>,
                <code>GET /api/platform/invitations</code>
              </li>
              <li>
                API keys: <code>POST /api/platform/api-keys</code>,
                <code>GET /api/platform/api-keys</code>,
                <code>POST /api/platform/api-keys/{id}/revoke</code>
              </li>
              <li>Platform summary: <code>GET /api/platform/summary</code></li>
            </ul>

            <details class="details">
              <summary>Implemented capabilities</summary>
              <ul>
                <li>FastAPI backend with SQLite persistence and audit events</li>
                <li>
                  Bulk database import API (SQLite/PostgreSQL/MySQL) using a
                  <code>SELECT</code> query
                </li>
                <li>
                  Durable async job queue (worker thread + persisted job state in
                  SQLite)
                </li>
                <li>Job APIs: list (<code>GET /api/jobs</code>) + detail</li>
                <li>Auth/RBAC APIs (bootstrap admin, login, user management)</li>
                <li>Web dashboard: upload, queue monitoring, analytics, review</li>
                <li>Dashboard topbar: Connect, Manual Deploy, Invite, API Key</li>
                <li>Unit tests for core pipeline logic</li>
              </ul>
            </details>

            <details class="details">
              <summary>Key files</summary>
              <ul>
                <li><code>backend/app/main.py</code>: API routes + orchestration</li>
                <li><code>backend/app/pipeline.py</code>: pipeline core</li>
                <li>
                  <code>backend/app/providers.py</code>: Azure/OpenAI/Anthropic
                  integrations
                </li>
                <li><code>backend/app/auth.py</code>: auth, hashing, RBAC</li>
                <li><code>backend/app/jobs.py</code>: durable background worker</li>
                <li><code>backend/app/deployments.py</code>: deploy triggers</li>
                <li>
                  <code>backend/app/document_tasks.py</code>: reusable task logic
                </li>
                <li><code>backend/app/rules.py</code>: runtime rules + persistence</li>
                <li><code>backend/app/config.py</code>: env-based config</li>
                <li>
                  <code>backend/tests/test_platform_api.py</code>: platform API
                  tests
                </li>
                <li><code>frontend/index.html</code>: dashboard shell</li>
                <li><code>frontend/app.v2.js</code>: dashboard behavior</li>
                <li><code>deploy/k8s/</code>: Kubernetes manifests</li>
                <li><code>docker-compose.yml</code>: local orchestration</li>
                <li><code>scripts/run_demo.sh</code>: end-to-end demo runner</li>
              </ul>
            </details>

            <details class="details">
              <summary>Run locally</summary>
              <pre><code>cd citysort
python3 -m venv .venv
source .venv/bin/activate
pip install -r backend/requirements.txt

cp .env.example .env
# Default .env values run fully local.</code></pre>
            </details>

            <h2>Safer AI rollout profile (recommended)</h2>
            <p>
              The system is designed so you can start rules-first, require human
              review, and only gradually enable external providers when
              connectivity and security controls are in place.
            </p>
            <ul>
              <li>
                Start with <code>CITYSORT_CLASSIFIER_PROVIDER=rules</code> and
                local OCR, then enable Anthropic for JSON classification when
                ready
              </li>
              <li>
                Keep a high confidence gate via
                <code>CITYSORT_CONFIDENCE_THRESHOLD</code>
              </li>
              <li>
                Force review for sensitive doc types via
                <code>CITYSORT_FORCE_REVIEW_DOC_TYPES</code>
              </li>
              <li>
                Require auth/RBAC:
                <code>CITYSORT_REQUIRE_AUTH=true</code> and strong secrets
              </li>
              <li>
                Use platform connectivity checks before routing real traffic to
                providers
              </li>
              <li>
                Keep audit trails on by default so every decision is traceable
              </li>
            </ul>

            <h2>Highlights</h2>
            <div class="callouts">
              <div class="callout">
                <h3>Provider switching + fallback</h3>
                <p>
                  Swap OCR/classification providers (rules/OpenAI/Anthropic) and
                  fall back to local processing when external calls fail.
                </p>
              </div>
              <div class="callout">
                <h3>Durable jobs + reprocess</h3>
                <p>
                  Async worker with persisted job state, plus a reprocess action
                  to apply updated rules/providers without re-upload.
                </p>
              </div>
              <div class="callout">
                <h3>Ops controls + audit trail</h3>
                <p>
                  Connectivity checks, deploy history, API keys, invitations, and
                  per-document audit events for traceability.
                </p>
              </div>
            </div>

            <h2>What I would show in a live demo</h2>
            <ol>
              <li>Upload a document: OCR, classification, validation, routing</li>
              <li>Human review: corrections, audit history, approval</li>
              <li>Switch providers + reprocess to apply updated rules</li>
            </ol>

            <h2>Next</h2>
            <p class="next-links">
              <a class="btn btn-small btn-ghost" href="../offlineai/"
                >Next: OfflineAI</a
              >
            </p>
          </div>
        </div>
      </section>
    </main>

    <footer class="site-footer">
      <div class="container footer-inner">
        <p class="footer-left">
          <span class="footer-mark" aria-hidden="true"></span>
          <span>Imran Tanbir</span>
        </p>
        <p class="footer-right">
          <a href="../../">Home</a>
          <span class="sep" aria-hidden="true">/</span>
          <a href="../../#projects">Projects</a>
          <span class="sep" aria-hidden="true">/</span>
          <a href="../../#contact">Contact</a>
        </p>
      </div>
    </footer>
  </body>
</html>
